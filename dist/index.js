!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("cesium/Source/Cesium.js"),require("@turf/turf"),require("lodash")):"function"==typeof define&&define.amd?define(["cesium/Source/Cesium.js","@turf/turf","lodash"],t):"object"==typeof exports?exports["cesium-plotting-symbol"]=t(require("cesium/Source/Cesium.js"),require("@turf/turf"),require("lodash")):e["cesium-plotting-symbol"]=t(e.Cesium,e["@turf/turf"],e.lodash)}(window,function(e,t,n){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}([function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(2),a=n(0),l=(i=a)&&i.__esModule?i:{default:i};var u=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.viewer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.maxPointNum=9999,this.viewer=n,this.layer=window.layer.biaohui,e.lastGraph&&e.lastGraph.finish(),e.lastGraph=this,this.initRootEntity(t)}return o(e,[{key:"initRootEntity",value:function(t){console.log("this layer: ",this.layer),this.graph=this.viewer.entities.add({id:void 0===t?this.layer.name+"_graph_"+e.seq++:t,parent:this.layer.rootEnt}),this.graph.ctl=this.viewer.entities.add({id:this.graph.id+"__ctl",parent:this.graph,graphType:"ctlRoot",show:!0}),this.graph.shape=this.viewer.entities.add({id:this.graph.id+"__shape",parent:this.graph,graphType:"shapeRoot",show:!0}),this.graph.graph=this}},{key:"addCtlPoint",value:function(t){var n=(0,r.convertScreenPos2Cartesian)(t.position);console.log("added a point: ",n);var i=this.viewer.entities.add({id:this.graph.id+"_ctlpoint_"+e.seq++,parent:this.graph.ctl,position:n,graphType:"ctl",point:{pixelSize:10,color:l.default.Color.fromBytes(255,255,255,80),heightReference:l.default.HeightReference.CLAMP_TO_GROUND,outlineWidth:1,outlineColor:l.default.Color.AQUA}});this.addHandler(i,this.graph.ctl)}},{key:"isFinished",value:function(){return this.graph.ctl._children.length>=this.maxPointNum}},{key:"deleteLastPoint",value:function(){var e=this.graph.ctl._children.pop();this.viewer.entities.remove(e),console.log("remove last control point: ",e)}},{key:"deleteCtlPoint",value:function(e){var t=this.graph.ctl._children.indexOf(e);this.graph.ctl._children.splice(t,1),window.viewer.entities.remove(e)}},{key:"addShape",value:function(t){var n=this;t.parent=this.graph.shape,t.graphType="shp",t.seq=e.seq,t.highLight=function(){return n.highLight(!0)},t.downLight=function(){return n.highLight(!1)},t.finish=function(){return n.finish()},t.toEdit=function(){return n.toEdit()},window.viewer.entities.add(t),console.log("add a shape : ",t)}},{key:"deleteShape",value:function(e){console.log("delete shap entity.");var t=this.graph.shape._children.indexOf(e);this.graph.shape._children.splice(t,1),window.viewer.entities.remove(e)}},{key:"addHandler",value:function(e,t){console.log("unimplemented")}},{key:"highLight",value:function(e){console.log("unimplemented")}},{key:"toEdit",value:function(){console.log("unimplemented")}},{key:"finish",value:function(){console.log("unimplemented")}}]),e}();u.seq=0,t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertPos=l,t.convertScreenPos2Cartesian=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=l(e);return r.default.Cartesian3.fromDegrees(n[0],n[1],t,r.default.Ellipsoid.WGS84)},t.convertCartesian=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.viewer).scene.globe.ellipsoid.cartesianToCartographic(e),n=r.default.Math.toDegrees(t.longitude),i=r.default.Math.toDegrees(t.latitude);return[n,i]},t.removeEntityTree=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.viewer;t._children.forEach(function(t){n.entities.remove(t),e(t,n)})},t.entityTree=function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.viewer;t._children.forEach(function(t){n(t),e(t,n,i)})},t.showTimeline=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.viewer;if(null===t||void 0===t)return;t.animation.container.hidden=!e,t.timeline.container.hidden=!e},t.dateToString=function(e){return r.default.JulianDate.toIso8601(r.default.JulianDate.fromDate(e))},t.point2Box=function(e,t,n){var i=a.distanceToDegrees(n/2,"meters");return[e-i,t+i,0,e+i,t+i,0,e+i,t-i,0,e-i,t-i,0]},t.czmlPos=function(e,t){return{id:e,position:{cartographicDegrees:t}}},t.czmlPoint=function(e,t){return{color:{rgba:e},pixelSize:t}},t.ctlPoint=function(e,t,n){return{id:e,position:{cartographicDegrees:[t,n,10]},point:{color:{rgba:[255,0,0,255]},pixelSize:6}}},t.czmlLabel=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"12pt Lucida Console",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30;return{font:t,text:e,pixelOffset:{cartesian2:[n,0]}}},t.czmlPath=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.default.HeightReference.NONE;return{material:{solidColor:{color:{rgba:e}}},width:1,leadTime:t,trailTime:n,resolution:t,heightReference:i}};var i,o=n(0),r=(i=o)&&i.__esModule?i:{default:i},a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(4));function l(e){var t=window.viewer.scene.globe.ellipsoid,n=window.viewer.camera.pickEllipsoid(e,t);if(n){var i=t.cartesianToCartographic(n);return[r.default.Math.toDegrees(i.longitude),r.default.Math.toDegrees(i.latitude)]}return[0,0]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.default),i(t,[{key:"addHandler",value:function(e,t){var n=this;2===t._children.length&&(this.ent=new o.default.Entity({id:"arrow1_"+r.default.seq++,polygon:{hierarchy:new o.default.CallbackProperty(function(e,t){return n.calcuteShape(n.graph.ctl._children.concat(window.cursor),e)},!1),fill:!0,material:new o.default.Color(.98,.5,.265,.2),height:0,outline:!0,outlineWidth:1,outlineColor:o.default.Color.fromCssColorString("#fd7f44")}}),this.addShape(this.ent))}},{key:"calcuteShape",value:function(e,t){return e.map(function(e){return e.position.getValue(t)})}},{key:"highLight",value:function(e){e?(this.ent.polygon.material.color.setValue(new o.default.Color(.98,.5,.265,.4).brighten(.6,new o.default.Color)),this.ent.parent.parent.ctl.show=!0):(this.ent.polygon.material.color.setValue(new o.default.Color(.98,.5,.265,.2)),this.ent.parent.parent.ctl.show=!1)}},{key:"toEdit",value:function(){var e=this;this.highLight(!0),this.ent.polygon.hierarchy.setCallback(function(t,n){return e.calcuteShape(e.graph.ctl._children,t)},!1)}},{key:"finish",value:function(){var e=this;this.ent&&(this.highLight(!1),this.ent.polygon.hierarchy.setCallback(function(t,n){return e.calcuteShape(e.graph.ctl._children,t)},!0))}}]),t}();t.default=l},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=s(n(1)),r=s(n(0)),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(4)),l=n(2),u=s(n(3)),c=s(n(5));function s(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var f=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,r=Array(o),a=0;a<o;a++)r[a]=arguments[a];return n=i=d(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),i.maxPointNum=2,i.ent=null,d(i,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),i(t,[{key:"addHandler",value:function(e,t){var n=this;1===t._children.length&&(this.ent=new r.default.Entity({id:"arrow1_"+o.default.seq++,polygon:{hierarchy:new r.default.CallbackProperty(function(e,t){return n.calcuteShape(n.graph.ctl._children.concat(window.cursor),e)},!1),fill:!0,material:new r.default.Color(.98,.5,.265,.2),height:0,outline:!0,outlineWidth:1,outlineColor:r.default.Color.fromCssColorString("#fd7f44")}}),this.addShape(this.ent))}},{key:"calcuteShape",value:function(e,t){var n=c.default.map(e,function(e){return e.position.getValue(t)});console.log("turf: ",c.default,a);var i=n.map(function(e){var t=(0,l.convertCartesian)(e);return a.point(t)});if(i.length>1){var o=[],u=i[0],s=i[1],d=a.bearing(u,s),f={units:"kilometers"};return o.push(a.destination(u,100,d,f)),o.push(a.destination(u,50,d+90,f)),o.push(a.destination(s,100,d+170,f)),o.push(a.destination(s,150,d+150,f)),o.push(a.destination(s,0,d,f)),o.push(a.destination(s,150,d-150,f)),o.push(a.destination(s,100,d-170,f)),o.push(a.destination(u,50,d-90,f)),o.map(function(e){return r.default.Cartesian3.fromDegrees(e.geometry.coordinates[0],e.geometry.coordinates[1],0,r.default.Ellipsoid.WGS84)})}return[]}}]),t}();t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.default),i(t,[{key:"addHandler",value:function(e,t){var n=this;1===t._children.length&&(this.ent=new o.default.Entity({id:"arrow1_"+r.default.seq++,polyline:{positions:new o.default.CallbackProperty(function(e,t){return n.calcuteShape(n.graph.ctl._children.concat(window.cursor),e)},!1),width:1,fill:!0,material:new o.default.Color(.98,.5,.265,.8),height:0,outline:!0,outlineWidth:1,outlineColor:o.default.Color.fromCssColorString("#fd7f44")}}),this.addShape(this.ent))}},{key:"calcuteShape",value:function(e,t){return e.map(function(e){return e.position.getValue(t)})}},{key:"highLight",value:function(e){e?(this.ent.polyline.outlineWidth=5,this.ent.parent.parent.ctl.show=!0):(this.ent.polyline.outlineWidth=1,this.ent.parent.parent.ctl.show=!1)}},{key:"toEdit",value:function(){var e=this;this.highLight(!0),this.ent.polyline.positions.setCallback(function(t,n){return e.calcuteShape(e.graph.ctl._children,t)},!1)}},{key:"finish",value:function(){var e=this;console.debug("finish Polyline graph: ",this),this.ent&&(this.highLight(!1),this.ent.polyline.positions.setCallback(function(t,n){return e.calcuteShape(e.graph.ctl._children,t)},!0))}}]),t}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=a(n(1)),r=a(n(0));function a(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,r=Array(o),a=0;a<o;a++)r[a]=arguments[a];return n=i=l(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),i.maxPointNum=1,l(i,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"addHandler",value:function(e,t){var n=this;this.ent=new r.default.Entity({id:"point_"+o.default.seq++,parent:this.ent,position:new r.default.CallbackProperty(function(t,i){return n.calcuteShape(e,t)},!1),point:{pixelSize:10,color:r.default.Color.fromCssColorString("#fd7f44"),heightReference:r.default.HeightReference.CLAMP_TO_GROUND},ctl:e}),this.addShape(this.ent)}},{key:"calcuteShape",value:function(e,t){return e.position.getValue(t)}},{key:"highLight",value:function(e){e?(this.ent.point.color.setValue(new r.default.Color(.98,.5,.265,.4).brighten(.6,new r.default.Color)),this.ent.parent.parent.ctl.show=!0):(this.ent.point.color.setValue(new r.default.Color(.98,.5,.265,.2)),this.ent.parent.parent.ctl.show=!1)}},{key:"toEdit",value:function(){var e=this;this.highLight(!0),this.ent.position.setCallback(function(t,n){return e.calcuteShape(e.graph.ctl._children[0],t)},!1)}},{key:"finish",value:function(){var e=this;this.ent&&(this.highLight(!1),this.ent.position.setCallback(function(t,n){return e.calcuteShape(e.graph.ctl._children[0],t)},!0))}}]),t}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(0),a=(i=r)&&i.__esModule?i:{default:i},l=n(2);var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mode=e.MODE_VIEW}return o(e,[{key:"nextMode",value:function(t){console.log("mode changed from '"+this.mode+"' by action '"+t+"'");for(var n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];switch(this.mode){case e.MODE_VIEW:switch(t){case e.ACT_START:this.selectMode()}break;case e.MODE_SELECT:switch(t){case e.ACT_CREATE:this.createMode.apply(this,i);break;case e.ACT_SELECT:this.editMode.apply(this,i);break;case e.ACT_FINISH:this.viewMode()}break;case e.MODE_CREATE:case e.MODE_EDIT:switch(t){case e.ACT_FINISH:this.selectMode();break;case e.ACT_CREATE:this.createMode.apply(this,i)}}}},{key:"viewMode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.viewer;this.mode=e.MODE_VIEW,console.log("into "+this.mode+" mode"),e.destroyHandler(),t.canvas.style.cursor="auto"}},{key:"createMode",value:function(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.viewer;this.mode=e.MODE_CREATE,console.log("into "+this.mode+" mode");var o=e.getHandler();i.canvas.style.cursor="crosshair",o.setInputAction(function(e){window.cursorScreenPos=(0,l.convertPos)(e.endPosition),window.cursorPos=a.default.Cartesian3.fromDegrees(window.cursorScreenPos[0],window.cursorScreenPos[1],0,a.default.Ellipsoid.WGS84)},a.default.ScreenSpaceEventType.MOUSE_MOVE),o.setInputAction(function(e){t.addCtlPoint(e),t.isFinished()&&n.finishCreate(t)},a.default.ScreenSpaceEventType.LEFT_CLICK),o.setInputAction(function(e){t.deleteLastPoint()},a.default.ScreenSpaceEventType.MIDDLE_CLICK),o.setInputAction(function(e){n.finishCreate(t)},a.default.ScreenSpaceEventType.RIGHT_CLICK),window.cursor=i.entities.add({id:"cursor",parent:t.layer.rootEnt,position:new a.default.CallbackProperty(function(e,t){return null===window.cursorPos?null:a.default.Cartesian3.clone(window.cursorPos)},!0),point:{pixelSize:10,color:a.default.Color.fromBytes(255,255,255,80),heightReference:a.default.HeightReference.CLAMP_TO_GROUND,outlineWidth:1,outlineColor:a.default.Color.AQUA}})}},{key:"finishCreate",value:function(t){(arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.viewer).entities.remove(window.cursor),t.finish(),this.nextMode(e.ACT_FINISH)}},{key:"selectMode",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.viewer;this.mode=e.MODE_SELECT,console.log("into "+this.mode+" mode");var i=e.getHandler();n.canvas.style.cursor="auto",i.setInputAction(function(e){var i=n.scene.drillPick(e.endPosition);if(a.default.defined(i))if(void 0===t.hoveredEnt&&i.length>0){var o=i.reduce(function(e,t){return t.id.seq>e.id.seq?t:e},i[0]);o.id.highLight(),n.canvas.style.cursor="pointer",t.hoveredEnt=o}else if(void 0!==t.hoveredEnt&&i.length>0){var r=i.reduce(function(e,t){return t.id.seq>e.id.seq?t:e},i[0]);t.hoveredEnt.id.downLight(),r.id.highLight(),n.canvas.style.cursor="pointer",t.hoveredEnt=r}else void 0!==t.hoveredEnt&&0===i.length&&(t.hoveredEnt.id.downLight(),n.canvas.style.cursor="auto",t.hoveredEnt=void 0)},a.default.ScreenSpaceEventType.MOUSE_MOVE),i.setInputAction(function(n){void 0!==t.hoveredEnt&&t.nextMode(e.ACT_SELECT,t.hoveredEnt.id)},a.default.ScreenSpaceEventType.LEFT_CLICK),i.setInputAction(function(n){t.nextMode(e.ACT_FINISH)},a.default.ScreenSpaceEventType.RIGHT_CLICK)}},{key:"editMode",value:function(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.viewer;this.mode=e.MODE_EDIT,console.log("into "+this.mode+" mode");var o=e.getHandler();i.canvas.style.cursor="crosshair",t.toEdit(),o.setInputAction(function(e){window.cursorScreenPos=(0,l.convertPos)(e.endPosition),window.cursorPos=a.default.Cartesian3.fromDegrees(window.cursorScreenPos[0],window.cursorScreenPos[1],0,a.default.Ellipsoid.WGS84)},a.default.ScreenSpaceEventType.MOUSE_MOVE),o.setInputAction(function(e){if(void 0!==n.pickedctl)n.unpick();else{var o=i.scene.drillPick(e.position);if(a.default.defined(o)){var r=o.filter(function(e){return"ctl"===e.id.graphType&&e.id.parent.parent===t.parent.parent});r.length>0&&n.pickup(r[0].id)}}},a.default.ScreenSpaceEventType.LEFT_CLICK),o.setInputAction(function(i){n.unpick(),t.finish(),n.nextMode(e.ACT_FINISH)},a.default.ScreenSpaceEventType.RIGHT_CLICK)}},{key:"pickup",value:function(e){console.log("pickup: ",e),e.position=new a.default.CallbackProperty(function(e,t){var n=(0,l.convertCartesian)(window.cursorPos);return a.default.Cartesian3.fromDegrees(n[0],n[1],0,a.default.Ellipsoid.WGS84)},!1),this.pickedctl=e}},{key:"unpick",value:function(e){void 0!==this.pickedctl&&(this.pickedctl.position=a.default.Cartesian3.clone(window.cursorPos),this.pickedctl=void 0)}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}},{key:"getHandler",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.viewer;return this.handler&&!this.handler.isDestroyed()||(this.handler=new a.default.ScreenSpaceEventHandler(e.scene.canvas)),this.handler}},{key:"destroyHandler",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.viewer;this.handler.destroy(),this.handler=void 0}}]),e}();u.MODE_VIEW="view",u.MODE_SELECT="select",u.MODE_EDIT="edit",u.MODE_CREATE="create",u.ACT_START="start",u.ACT_CREATE="create",u.ACT_SELECT="select",u.ACT_FINISH="finish",t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(9)),o=u(n(8)),r=u(n(3)),a=u(n(7)),l=u(n(6));function u(e){return e&&e.__esModule?e:{default:e}}t.default={EditMode:i.default,Point:o.default,Polyline:a.default,Polygon:r.default,Arrow1:l.default,start:function(e){i.default.getInstance().nextMode(i.default.ACT_START),i.default.getInstance().nextMode(i.default.ACT_CREATE,e)}}}])});